<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: User</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">User</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/user_rb.html">
                app/models/user.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Генерируеме метода для пополнения
баланса пользователя внутренними
платежами: credit_find_track - пополнение баланса
за выполнение задания в столе заказов
credit_add_news - пополнение баланса за
дополнение путевой новости credit_upload_track - -
пополнение баланса за загрузку
нормального трека
</p>
<p>
Генерируеме метода для списанияс
баланса пользователя внутренними
платежами: debit_assorted_track - списание с
баланса пользователя за нарезку трека
debit_download_track - списание с баланса
пользователя за скачивание трека
debit_order_track - списание с баланса
пользователя за размещение заказа в
столе заказов
</p>
<p>
Все методы списания, пополнеия принимают
один аргумент комментарий или массив
комментариев Подробное описание в
методах lib/balance.rb
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000059">activate!</a>&nbsp;&nbsp;
      <a href="#M000057">add_default_role</a>&nbsp;&nbsp;
      <a href="#M000051">add_one_download</a>&nbsp;&nbsp;
      <a href="#M000070">add_role</a>&nbsp;&nbsp;
      <a href="#M000076">add_to_cart</a>&nbsp;&nbsp;
      <a href="#M000072">admin?</a>&nbsp;&nbsp;
      <a href="#M000063">block!</a>&nbsp;&nbsp;
      <a href="#M000075">cart_tracks</a>&nbsp;&nbsp;
      <a href="#M000053">create_ftp_account</a>&nbsp;&nbsp;
      <a href="#M000077">delete_from_cart</a>&nbsp;&nbsp;
      <a href="#M000054">delete_ftp_account</a>&nbsp;&nbsp;
      <a href="#M000066">deliver_activation_confirmation!</a>&nbsp;&nbsp;
      <a href="#M000065">deliver_activation_instructions!</a>&nbsp;&nbsp;
      <a href="#M000067">deliver_password_reset_instructions!</a>&nbsp;&nbsp;
      <a href="#M000074">file_link_of</a>&nbsp;&nbsp;
      <a href="#M000068">get_roles</a>&nbsp;&nbsp;
      <a href="#M000069">has_role?</a>&nbsp;&nbsp;
      <a href="#M000052">pay_for_find</a>&nbsp;&nbsp;
      <a href="#M000050">refill_balance</a>&nbsp;&nbsp;
      <a href="#M000049">refill_balance_over_mobilcent</a>&nbsp;&nbsp;
      <a href="#M000048">refill_balance_over_webmoney</a>&nbsp;&nbsp;
      <a href="#M000071">remove_role</a>&nbsp;&nbsp;
      <a href="#M000073">role_symbols</a>&nbsp;&nbsp;
      <a href="#M000056">search_user</a>&nbsp;&nbsp;
      <a href="#M000055">set_ftp_password</a>&nbsp;&nbsp;
      <a href="#M000058">signup!</a>&nbsp;&nbsp;
      <a href="#M000062">term_ban=</a>&nbsp;&nbsp;
      <a href="#M000061">term_ban_in_days</a>&nbsp;&nbsp;
      <a href="#M000078">top_balance</a>&nbsp;&nbsp;
      <a href="#M000064">unblock!</a>&nbsp;&nbsp;
      <a href="#M000060">valid_block</a>&nbsp;&nbsp;
      <a href="#M000047">withdraw</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="Balance.html">Balance</a></span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FTP_PATH</td>
          <td>=</td>
          <td class="context-item-value">File.join(Rails.root, 'data', 'ftp')</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">term_ban</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000051" class="method-detail">
        <a name="M000051"></a>

        <div class="method-heading">
          <a href="#M000051" class="method-signature">
          <span class="method-name">add_one_download</span><span class="method-args">(user_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000051-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000051-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 114</span>
114:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_one_download</span>(<span class="ruby-identifier">user_id</span>)
115:     <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">user_id</span>)
116:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:total_download</span>, <span class="ruby-identifier">user</span>.<span class="ruby-identifier">total_download</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
117:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">save!</span>
118:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000052" class="method-detail">
        <a name="M000052"></a>

        <div class="method-heading">
          <a href="#M000052" class="method-signature">
          <span class="method-name">pay_for_find</span><span class="method-args">(user_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000052-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000052-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 121</span>
121:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pay_for_find</span>(<span class="ruby-identifier">user_id</span>)
122:     <span class="ruby-identifier">profit</span> = <span class="ruby-constant">Profit</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-value str">&quot;find_track&quot;</span>)
123:     <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">user_id</span>)
124:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">balance</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">profit</span>.<span class="ruby-identifier">amount</span>
125:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">save</span>
126:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000056" class="method-detail">
        <a name="M000056"></a>

        <div class="method-heading">
          <a href="#M000056" class="method-signature">
          <span class="method-name">search_user</span><span class="method-args">(query, per_page)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000056-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000056-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 161</span>
161:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search_user</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">per_page</span>)
162:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:q</span>].<span class="ruby-identifier">empty?</span>
163:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:attribute</span>]
164:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;login&quot;</span>
165:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span> <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:login</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:q</span>] }, <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:page</span>]
166:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;email&quot;</span>
167:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span> <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:q</span>] }, <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:page</span>]
168:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;ip&quot;</span>
169:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span> <span class="ruby-node">&quot;@(last_login_ip,current_login_ip) #{query[:q]}&quot;</span>, <span class="ruby-identifier">:match_mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:extended</span>
170:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;id&quot;</span>
171:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span> <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:q</span>] }, <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:page</span>]
172:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;balance&quot;</span>
173:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span> <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:webmoney_purse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:q</span>] }, <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:page</span>]
174:       <span class="ruby-keyword kw">else</span>
175:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:q</span>], <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:page</span>]
176:       <span class="ruby-keyword kw">end</span>
177:     <span class="ruby-keyword kw">else</span>
178:       []
179:     <span class="ruby-keyword kw">end</span>
180:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">top_balance</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Топ пользователей по балансу
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 359</span>
359:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">top_balance</span>
360:       <span class="ruby-identifier">all</span> <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;balance &gt; 0&quot;</span>], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;balance DESC&quot;</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-constant">AppSetting</span>.<span class="ruby-identifier">top_users</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-value">5</span> )
361:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000059" class="method-detail">
        <a name="M000059"></a>

        <div class="method-heading">
          <a href="#M000059" class="method-signature">
          <span class="method-name">activate!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000059-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000059-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">activate!</span>
200:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span> = <span class="ruby-keyword kw">true</span>
201:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">playlists</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Без названия&quot;</span>)
202:     <span class="ruby-identifier">save</span>
203:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000057" class="method-detail">
        <a name="M000057"></a>

        <div class="method-heading">
          <a href="#M000057" class="method-signature">
          <span class="method-name">add_default_role</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000057-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000057-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 182</span>
182:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_default_role</span>
183:     <span class="ruby-identifier">add_role</span>(<span class="ruby-identifier">:user</span>)
184:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <a href="#M000070" class="method-signature">
          <span class="method-name">add_role</span><span class="method-args">(role)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
user.add_role(&quot;admin&quot;)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000070-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000070-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 273</span>
273:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_role</span>(<span class="ruby-identifier">role</span>)
274:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_role?</span>(<span class="ruby-identifier">role</span>)
275:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">roles</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Role</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">role</span>.<span class="ruby-identifier">to_s</span>)
276:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000076" class="method-detail">
        <a name="M000076"></a>

        <div class="method-heading">
          <a href="#M000076" class="method-signature">
          <span class="method-name">add_to_cart</span><span class="method-args">(params_track_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Добавление файлов в корзину
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000076-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000076-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 336</span>
336:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_to_cart</span>(<span class="ruby-identifier">params_track_ids</span>)
337:     <span class="ruby-identifier">params_track_ids</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">track_id</span><span class="ruby-operator">|</span>
338:       <span class="ruby-identifier">track_in_cart</span> = <span class="ruby-constant">CartTrack</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;track_id = ? and user_id = ?&quot;</span>, <span class="ruby-identifier">track_id</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>])
339:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">track_in_cart</span>
340:         <span class="ruby-identifier">cart_track</span> = <span class="ruby-constant">CartTrack</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:track_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">track_id</span>, <span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cart_tracks</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">track_id</span>)
341:         <span class="ruby-identifier">cart_track</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cart_track</span>
342:       <span class="ruby-keyword kw">end</span>
343:     <span class="ruby-keyword kw">end</span>
344:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000072" class="method-detail">
        <a name="M000072"></a>

        <div class="method-heading">
          <a href="#M000072" class="method-signature">
          <span class="method-name">admin?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000072-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000072-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 284</span>
284:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">admin?</span>
285:     <span class="ruby-ivar">@_roles</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">roles</span>
286:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_role?</span>(<span class="ruby-value str">&quot;admin&quot;</span>) <span class="ruby-operator">||</span>
287:       <span class="ruby-ivar">@_roles</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">permissions</span>[<span class="ruby-identifier">:admin</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">permissions</span> }
288:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000063" class="method-detail">
        <a name="M000063"></a>

        <div class="method-heading">
          <a href="#M000063" class="method-signature">
          <span class="method-name">block!</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
блокируем пользователя
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000063-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000063-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 229</span>
229:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block!</span>(<span class="ruby-identifier">params</span>)
230:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">term_ban</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:term_ban</span>]
231:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ban_reason</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ban_reason</span>]
232:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">type_ban</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:type_ban</span>]
233:     <span class="ruby-identifier">save!</span>
234:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000075" class="method-detail">
        <a name="M000075"></a>

        <div class="method-heading">
          <a href="#M000075" class="method-signature">
          <span class="method-name">cart_tracks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Массив треков в корзине
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000075-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000075-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 325</span>
325:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cart_tracks</span>
326:     <span class="ruby-identifier">tracks</span> = []
327:     <span class="ruby-identifier">cart_tracks</span> = <span class="ruby-constant">CartTrack</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>})
328:     <span class="ruby-identifier">cart_tracks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cart_track</span><span class="ruby-operator">|</span>
329:       <span class="ruby-identifier">track</span> = <span class="ruby-constant">Track</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cart_track</span>.<span class="ruby-identifier">track_id</span>)
330:       <span class="ruby-identifier">tracks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">track</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">track</span>
331:     <span class="ruby-keyword kw">end</span>
332:     <span class="ruby-identifier">tracks</span>
333:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000053" class="method-detail">
        <a name="M000053"></a>

        <div class="method-heading">
          <a href="#M000053" class="method-signature">
          <span class="method-name">create_ftp_account</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Создаем учетную запись ftp
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000053-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000053-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 140</span>
140:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_ftp_account</span>
141:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">FTP_PATH</span>, <span class="ruby-identifier">email</span>), <span class="ruby-identifier">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0777</span>
142:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">delete_from_cart</span><span class="method-args">(params_track_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Удаление файлов из корзины
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 347</span>
347:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_from_cart</span>(<span class="ruby-identifier">params_track_ids</span>)
348:     <span class="ruby-identifier">params_track_ids</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">track_id</span><span class="ruby-operator">|</span>
349:       <span class="ruby-identifier">track</span> = <span class="ruby-constant">Track</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">track_id</span>)
350:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">track</span>
351:         <span class="ruby-identifier">cart_track</span> = <span class="ruby-constant">CartTrack</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:track_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">track</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>})
352:         <span class="ruby-identifier">cart_track</span>.<span class="ruby-identifier">destroy</span>
353:       <span class="ruby-keyword kw">end</span>
354:     <span class="ruby-keyword kw">end</span>
355:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="#M000054" class="method-signature">
          <span class="method-name">delete_ftp_account</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Удаляем учетную запись ftp
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000054-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000054-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_ftp_account</span>
145:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">FTP_PATH</span>, <span class="ruby-identifier">email</span>)
146:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000066" class="method-detail">
        <a name="M000066"></a>

        <div class="method-heading">
          <a href="#M000066" class="method-signature">
          <span class="method-name">deliver_activation_confirmation!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000066-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000066-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deliver_activation_confirmation!</span>
251:     <span class="ruby-identifier">reset_perishable_token!</span>
252:     <span class="ruby-constant">Notifier</span>.<span class="ruby-identifier">deliver_activation_confirmation</span>(<span class="ruby-keyword kw">self</span>)
253:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000065" class="method-detail">
        <a name="M000065"></a>

        <div class="method-heading">
          <a href="#M000065" class="method-signature">
          <span class="method-name">deliver_activation_instructions!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
deliver
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000065-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000065-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 245</span>
245:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deliver_activation_instructions!</span>
246:     <span class="ruby-identifier">reset_perishable_token!</span>
247:     <span class="ruby-constant">Notifier</span>.<span class="ruby-identifier">deliver_activation_instructions</span>(<span class="ruby-keyword kw">self</span>)
248:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">deliver_password_reset_instructions!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 256</span>
256:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deliver_password_reset_instructions!</span>
257:     <span class="ruby-identifier">reset_perishable_token!</span>
258:     <span class="ruby-constant">Notifier</span>.<span class="ruby-identifier">deliver_password_reset_instructions</span>(<span class="ruby-keyword kw">self</span>)
259:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000074" class="method-detail">
        <a name="M000074"></a>

        <div class="method-heading">
          <a href="#M000074" class="method-signature">
          <span class="method-name">file_link_of</span><span class="method-args">(track)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
tracks
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000074-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000074-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 320</span>
320:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_link_of</span>(<span class="ruby-identifier">track</span>)
321:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">file_links</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;track_id = ? and state = ?&quot;</span>, <span class="ruby-identifier">track</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'available'</span>])
322:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">get_roles</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 261</span>
261:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_roles</span>
262:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">roles</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span>
263:       <span class="ruby-identifier">role</span>.<span class="ruby-identifier">name</span>
264:     }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;/&quot;</span>)
265:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">has_role?</span><span class="method-args">(role)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
roles
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 268</span>
268:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_role?</span>(<span class="ruby-identifier">role</span>)
269:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">roles</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-identifier">role</span>.<span class="ruby-identifier">to_s</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
270:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000050" class="method-detail">
        <a name="M000050"></a>

        <div class="method-heading">
          <a href="#M000050" class="method-signature">
          <span class="method-name">refill_balance</span><span class="method-args">(options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000050-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000050-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/user.rb, line 87</span>
87:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refill_balance</span>(<span class="ruby-identifier">options</span>)
88:       <span class="ruby-identifier">create!</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:date_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>),
89:                               <span class="ruby-identifier">:type_payment</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">FOREIGN</span>,
90:                               <span class="ruby-identifier">:type_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">CREDIT</span>
91:                             }))
92:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000049" class="method-detail">
        <a name="M000049"></a>

        <div class="method-heading">
          <a href="#M000049" class="method-signature">
          <span class="method-name">refill_balance_over_mobilcent</span><span class="method-args">(amount)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
пополнение баланса через webmoney
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000049-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000049-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/user.rb, line 79</span>
79:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refill_balance_over_mobilcent</span>(<span class="ruby-identifier">amount</span>)
80:       <span class="ruby-identifier">refill_balance</span>({
81:                        <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>,
82:                        <span class="ruby-identifier">:gateway</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">GATEWAY_MOBILCENT</span>,
83:                        <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Пополнение через Mobilcent&quot;</span>,
84:                        <span class="ruby-identifier">:kind_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">REFILL_BALANCE_SMS</span>
85:                      })
86:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000048" class="method-detail">
        <a name="M000048"></a>

        <div class="method-heading">
          <a href="#M000048" class="method-signature">
          <span class="method-name">refill_balance_over_webmoney</span><span class="method-args">(amount)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
пополнение баланса через webmoney
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000048-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000048-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/user.rb, line 70</span>
70:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refill_balance_over_webmoney</span>(<span class="ruby-identifier">amount</span>)
71:       <span class="ruby-identifier">refill_balance</span>({
72:                        <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>,
73:                        <span class="ruby-identifier">:gateway</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">GATEWAY_WEBMONEY</span>,
74:                        <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Пополнение через Webmoney&quot;</span>,
75:                        <span class="ruby-identifier">:kind_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">REFILL_BALANCE_WEBMONEY</span>
76:                      })
77:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000071" class="method-detail">
        <a name="M000071"></a>

        <div class="method-heading">
          <a href="#M000071" class="method-signature">
          <span class="method-name">remove_role</span><span class="method-args">(role)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000071-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000071-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 278</span>
278:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_role</span>(<span class="ruby-identifier">role</span>)
279:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_role?</span>(<span class="ruby-identifier">role</span>)
280:     <span class="ruby-identifier">role</span> = <span class="ruby-constant">Role</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">role</span>)
281:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">roles</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">role</span>)
282:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000073" class="method-detail">
        <a name="M000073"></a>

        <div class="method-heading">
          <a href="#M000073" class="method-signature">
          <span class="method-name">role_symbols</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
permissions
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000073-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000073-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 292</span>
292:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">role_symbols</span>
293:     (<span class="ruby-identifier">roles</span> <span class="ruby-operator">||</span> []).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span>
294:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">role</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-value str">&quot;custom&quot;</span>)
295:         <span class="ruby-constant">Role</span><span class="ruby-operator">::</span><span class="ruby-constant">BOOL_PERMISSIONS</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;custom_#{x}&quot;</span>.<span class="ruby-identifier">underscore</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{x}?&quot;</span>)}
296:       <span class="ruby-keyword kw">else</span>
297:         [
298:          <span class="ruby-constant">Role</span><span class="ruby-operator">::</span><span class="ruby-constant">BOOL_PERMISSIONS</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;custom_#{x}&quot;</span>.<span class="ruby-identifier">underscore</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{x}?&quot;</span>)},
299:          <span class="ruby-identifier">role</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">underscore</span>.<span class="ruby-identifier">to_sym</span> ]
300:       <span class="ruby-keyword kw">end</span>
301:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
302:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <a href="#M000055" class="method-signature">
          <span class="method-name">set_ftp_password</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Установка пароля для ftp доступ
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000055-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000055-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_ftp_password</span>
149:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ftp_access</span> = <span class="ruby-identifier">upload_on_ftp?</span>
150:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ftp_password</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-identifier">password</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">password</span>.<span class="ruby-identifier">blank?</span>
151:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000058" class="method-detail">
        <a name="M000058"></a>

        <div class="method-heading">
          <a href="#M000058" class="method-signature">
          <span class="method-name">signup!</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000058-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000058-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 186</span>
186:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signup!</span>(<span class="ruby-identifier">params</span>)
187:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">login</span>                 = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:login</span>]
188:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">email</span>                 = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:email</span>]
189:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">password</span>              = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:password</span>]
190:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">password_confirmation</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:password_confirmation</span>]
191: 
192:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">icq</span>                   = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:icq</span>]
193:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">webmoney_purse</span>        = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:webmoney_purse</span>]
194:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">captcha_solution</span>      = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:captcha_solution</span>].<span class="ruby-identifier">downcase</span>
195:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">captcha_challenge</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:captcha_challenge</span>]
196:     <span class="ruby-identifier">save_without_session_maintenance</span>
197:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000062" class="method-detail">
        <a name="M000062"></a>

        <div class="method-heading">
          <a href="#M000062" class="method-signature">
          <span class="method-name">term_ban=</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000062-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000062-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 223</span>
223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">term_ban=</span>(<span class="ruby-identifier">d</span>)
224:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ban</span> = <span class="ruby-keyword kw">true</span>
225:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_ban</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
226:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">end_ban</span>  = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span><span class="ruby-operator">+</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span>).<span class="ruby-identifier">end_of_day</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
227:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">term_ban_in_days</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
срок бана в днях
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 218</span>
218:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">term_ban_in_days</span>
219:     (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">end_ban</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_ban</span>.<span class="ruby-identifier">blank?</span>) <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span>
220:       ((<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">end_ban</span> <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_ban</span>)<span class="ruby-operator">/</span><span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>).<span class="ruby-identifier">to_i</span>
221:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000064" class="method-detail">
        <a name="M000064"></a>

        <div class="method-heading">
          <a href="#M000064" class="method-signature">
          <span class="method-name">unblock!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Разблокировка пользователя
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000064-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000064-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 237</span>
237:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unblock!</span>
238:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ban</span> = <span class="ruby-keyword kw">false</span>
239:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_ban</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">end_ban</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ban_reason</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">type_ban</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>
240:     <span class="ruby-identifier">save!</span>
241:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000060" class="method-detail">
        <a name="M000060"></a>

        <div class="method-heading">
          <a href="#M000060" class="method-signature">
          <span class="method-name">valid_block</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
&#8212;&#8212;- Блокировка пользователя
&#8212;&#8212;- валидация при блокировки
пользователя
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000060-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000060-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 208</span>
208:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valid_block</span>(<span class="ruby-identifier">params</span>)
209:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
210:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">:term_ban</span>, <span class="ruby-identifier">:invalid</span>)   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:term_ban</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:term_ban</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
211:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_on_blank</span>(<span class="ruby-identifier">:ban_reason</span>)  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ban_reason</span>].<span class="ruby-identifier">blank?</span>
212:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_on_blank</span>(<span class="ruby-identifier">:type_ban</span>)    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:type_ban</span>].<span class="ruby-identifier">blank?</span>
213:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">:type_ban</span>, <span class="ruby-identifier">:inclusion</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Settings</span>[<span class="ruby-identifier">:type_ban</span>][<span class="ruby-value str">&quot;value_for_valid&quot;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:type_ban</span>].<span class="ruby-identifier">to_i</span>)
214:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">blank?</span>
215:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000047" class="method-detail">
        <a name="M000047"></a>

        <div class="method-heading">
          <a href="#M000047" class="method-signature">
          <span class="method-name">withdraw</span><span class="method-args">(_amount)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Вывод денег
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000047-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000047-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/user.rb, line 54</span>
54:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">withdraw</span>(<span class="ruby-identifier">_amount</span>)
55:       <span class="ruby-identifier">create</span>({
56:                 <span class="ruby-identifier">:date_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>),
57:                 <span class="ruby-identifier">:type_payment</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">FOREIGN</span>,
58:                 <span class="ruby-identifier">:type_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">DEBIT</span>,
59:                 <span class="ruby-identifier">:kind_transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">WITHDRAW</span>,
60:                 <span class="ruby-identifier">:gateway</span>          =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Transaction</span><span class="ruby-operator">::</span><span class="ruby-constant">GATEWAY_WEBMONEY</span>,
61:                 <span class="ruby-identifier">:amount</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_amount</span>,
62:                 <span class="ruby-identifier">:comment</span>          =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value str">&quot;withdraw_over_webmoney&quot;</span>),
63: 
64:               })
65:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>