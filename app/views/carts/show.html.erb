<%= form_tag arhives_carts_path, :id => "cart" do  %>

<div id="link"><%= render :partial => "archive_link" if session[:archive] %></div>
<ul class="catalog dotted">
  <li class="selected"><a href="#" />Корзина</a></li>
</ul>


<div class="new-popular">
  <div class="corner-r"></div>
  <div id="result"></div>
  <div id="your_link"></div>
  <% unless @tracks.blank? %>
  <div>
    <%= link_to "Выделить все", "", :class => "select-all-check", :"data-check_name" => "track_ids[]" %>
  </div>
  <% end %>
  <table id="tracks" class="mp3-list">
    <% @tracks.each_with_index do |cart_track, i| %>
    <%= render :partial => "track", :locals => {:track => cart_track.track, :index => i, :count_downloads => false} %>
    <% end %>
  </table>

  <div class="corner-lb"><span></span></div>

</div>

<div class="right">
  <%= submit_tag "Создать архив для скачивания", :id => "create_archive" %>
  <%= submit_tag "Удалить выбранные", :name => "delete", :id => "delete_tracks" %>
</div>
<% end %>

<script type="text/javascript" charset="utf-8">

  $(function(){

     $('input:checkbox').click(function() {
        var buttonsChecked = $('input:checkbox:checked');
        if (buttonsChecked.length) {
          $('#create_archive').removeAttr('disabled');$('#delete_tracks').removeAttr('disabled');
        } else {
          $('#create_archive').attr('disabled', 'disabled');$('#delete_tracks').attr('disabled', 'disabled');
        }
      });

    $("#delete_tracks").click(function () {
      $.ajax({
           type: 'DELETE',
            url: "<%= carts_path(:js) %>",
           data: $("#cart").serialize()
       });
     return false;
    });

    $("#create_archive").click(function () {
        $.ajax({
           type: 'POST',
            url: "<%= arhives_carts_path(:js) %>",
           data: $("#cart").serialize()
       });
     return false;

    });

  });
</script>

