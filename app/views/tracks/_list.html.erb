
<% if current_user %>
  <button style="float:right;" id="to_playlist_button" type="single_button" disabled="disabled">В плейлист</button>
  <button style="float:left;" id="to_cart_button" type="single_button" disabled="disabled">В корзину</button>
<% end %>
<table id="tracks" class="mp3-list">
  <% form_tag to_playlist_admin_playlists_path, :id => "track_form", :method => :post do %>
    <%= hidden_field_tag "cart", "off", :id => "on_off_cart" %>
    <% if current_user %>
      <div id="choose_playlist" style="display:<%= RAILS_ENV=='test' ? 'inline' : 'none' %>;float:right;">
        <h2>Выбрать плейлист:</h2>
        <%= select nil, "playlist_id", current_user.playlists.all.collect {|p| [p.title, p.id]} %>
        <%= submit_tag "OK", :id => "add_to_playlist" %>
      </div>
    <% end %>
    <% @tracks.each_with_index do |track, index| %>
      <%= render :partial => "tracks/track", :locals => {:track => track, :index => index, :count_downloads => false} %>
    <% end %>
  <% end %>
</table>
<%= paginate @tracks if paginate %>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
   $('input:checkbox').click(function() {
      var buttonsChecked = $('input:checkbox:checked');
      if (buttonsChecked.length) {$('#to_playlist_button').removeAttr('disabled');$('#to_cart_button').removeAttr('disabled');}
      else {$('#to_playlist_button').attr('disabled', 'disabled');$('#to_cart_button').attr('disabled', 'disabled');}
   });

   $("#to_playlist_button").click(function () {
     $("#choose_playlist").toggle();
   });

    $("#to_cart_button").click(function () {
      $("#track_form").attr({action: "/admin/playlists/to_cart"});
      $("#on_off_cart").attr({value: "on"});
      $("#track_form").trigger("submit");
    });

    $("#track_form").submit(function(){
       $.ajax({
             "url": $(this).attr('action')+'.js',
            "data": $(this).serialize(),
            "type": "POST",
         "success": function(data) { },
          });
       return false;
    });

  });
</script>

