<%= javascript_include_tag 'swfobject', 'audio-player' %>
<%= javascript_include_tag "soundmanager2.js" %>



<script type="text/javascript">

var mySound = null

soundManager.url = '/flash/'; // directory where SM2 .SWFs live
soundManager.useFlashBlock = false; // skip for now. See the flashblock demo when you want to start getting fancy.
soundManager.debugMode = true;
soundManager.onready(function(oStatus) {
  // check if SM2 successfully loaded..
  if (oStatus.success) {
    // SM2 has loaded - now you can create and play sounds!
    mySound = soundManager.createSound({
      id: 'aSound',
      url: 'http://freshly-ground.com/data/audio/mpc/20060826%20-%20Armstrong.mp3'
    });
  }
});


function play() {
  start_position = $('#time_start').attr('value') + "000";
  mySound.setPosition(parseInt(start_position));
  mySound.play({position:start_position});
  setInterval("end();", 200);
}


function end() {
  end_time = $('#time_stop').attr('value') + "000";
  if(mySound.position >= end_time) {
    mySound.stop();
  }
}



</script>

<a href="#" onclick="mySound.stop();">Stop</a>
<a href="#" onclick="play();">Play</a>
<a href="#" onclick="alert(mySound.position)">Position</a>

<h1>Нарезка треков</h1>
<div>
  <h4>Иформация по треку</h4>
  ......
</div>

<span id="audioplayer_<%= @track.id %>"></span>
<div class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" id="slider-range" style="width: 400px;">
</div>
<% form_tag cut_mp3_cut_path, :method => :post do  -%>
<%= hidden_field_tag 'id', @track.id %>
<%= hidden_field_tag 'time[start]' %>
<%= hidden_field_tag 'time[stop]' %>
<span id="time">00:00  - <%= @_ll %></span>
<%= submit_tag "Нарезать и скачать" %>
<% end -%>

<script type="text/javascript">
 $(function(){
			$("#slider-range").slider({
				range: true,
				min: 0,
				max: "<%= @length %>",
				values: [0, "<%= @length %>"],
				slide: slideTime
			});
			function slideTime(event, ui){
        var start_time =  parseInt($("#slider-range").slider("values", 0));
        var stop_time  =  parseInt($("#slider-range").slider("values", 1));
        $("#time_start").val(start_time);
        $("#time_stop").val(stop_time);
				var minutes0 = parseInt($("#slider-range").slider("values", 0) % 60);
				var hours0 = parseInt($("#slider-range").slider("values", 0) / 60 % 24);
				var minutes1 = parseInt($("#slider-range").slider("values", 1) % 60);
				var hours1 = parseInt($("#slider-range").slider("values", 1) / 60 % 24);
				$("#time").text(getTime(hours0, minutes0) + ' - ' + getTime(hours1, minutes1));
			}

			function getTime(hours, minutes) {
				var time = null;
				minutes = minutes + "";
				return hours + ":" + minutes;
			}
			slideTime();
 });
</script>

